[gcode_macro _FILAMENT_BALL]
description: Helper: Round the filament tip
gcode:
  {% set wait = params.WAIT|default(0) %}
  
  {% if printer['gcode_macro _USER_VARIABLE'].debug == 1 %}
    {action_respond_info('==== _FILAMENT_BALL ====')}
    {action_respond_info("WAIT: %s" % (WAIT))}
    {action_respond_info('===============')}
  {% endif %}

  ##### end of definitions #####
  SAVE_GCODE_STATE NAME=STATE_FILAMENT_BALL
  # Ball up the filament tip
  G92 E0       ; zero the extruder
  M82          ; absolute extrusion
  G1 E2 F3600
  G1 E0 F3600
  G1 E4 F3600
  G1 E0 F3600
  G1 E8 F3600
  G1 E0 F3600
  M83          ; relative extrusion
  G1 E-25 F3600
  G4 P{wait|int * 1000}
  RESTORE_GCODE_STATE NAME=STATE_FILAMENT_BALL
